{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Carrito - Tienda USC</title>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

<body>

  <!-- HEADER -->
  <header class="site-header">
    <div class="header-inner">

      <a class="header-logo" href="{% url 'catalogo' %}">
        <img src="{% static 'images/logo-usc.png' %}" alt="USC Logo">
        <div style="font-weight:700">Tienda Oficial USC</div>
      </a>

      <div class="header-search">
        <input placeholder="Buscar productos..." id="global-search-cart">
      </div>

      <div class="header-actions">
        {% if user.is_authenticated %}
          <span>Hola, {{ user.username }}</span>
          <a href="{% url 'logout' %}">Cerrar sesión</a>
        {% else %}
          <a href="{% url 'login' %}">Iniciar sesión</a>
        {% endif %}

        <a href="{% url 'catalogo' %}">Catálogo</a>
        <a href="{% url 'carrito' %}" class="cart-badge">
          Carrito <span id="cart-count">{{ total_items_carrito }}</span>
        </a>
      </div>

    </div>
  </header>

  <!-- MAIN -->
  <main class="container">
    <h2>Carrito de compras</h2>

    <div class="cart-panel" style="display:flex; gap:18px; flex-wrap:wrap;">

      <!-- LISTA DEL CARRITO -->
      <div style="flex:1;">

        {% if items %}
          {% for item in items %}
            <div class="cart-item-card">

              <div class="cart-item-info">
                <h3>{{ item.producto.nombre }}</h3>
                <p>Precio: ${{ item.producto.precio }}</p>

                <form method="POST" action="{% url 'actualizar_carrito' item.id %}">
                  {% csrf_token %}
                  <input type="number" name="cantidad" value="{{ item.cantidad }}" min="1" style="width:60px;">
                  <button class="btn-sm" type="submit">Actualizar</button>
                </form>
              </div>

              <div>
                <p><strong>Subtotal: ${{ item.subtotal }}</strong></p>

                <form method="POST" action="{% url 'eliminar_carrito' item.id %}">
                  {% csrf_token %}
                  <button class="btn-danger" type="submit">Eliminar</button>
                </form>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <p>Tu carrito está vacío.</p>
          <a href="{% url 'catalogo' %}" class="btn">Ir al catálogo</a>
        {% endif %}

      </div>

      <!-- RESUMEN -->
      <div style="width:320px;">
        <div class="card">

          {% if items %}
            <h3>Resumen de compra</h3>
            <p>Productos: {{ total_items_carrito }}</p>
            <h2>Total: ${{ total }}</h2>

            <a href="{% url 'checkout' %}" class="btn-primary" style="display:block;">
              Proceder al pago
            </a>
          {% else %}
            <p>No hay productos para mostrar.</p>
          {% endif %}

        </div>
      </div>

    </div>
  </main>

  <footer class="site-footer">© Universidad Santiago de Cali - Tienda Oficial</footer>
  <script src="{% static 'js/main.js' %}"></script>

</body>
</html>
